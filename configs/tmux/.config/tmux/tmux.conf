# Steve's Minimal Tmux Config
# Philosophy: Stock tmux + Zellij-style Alt bindings + Catppuccin theme
# Customize as friction is discovered, not upfront

# =============================================================================
# PREFIX
# =============================================================================
# Using Ctrl+Space for ergonomics on Mac with Caps Lock â†’ Control
set -g prefix C-Space
unbind C-b
bind C-Space send-prefix

# =============================================================================
# TERMINAL SETTINGS
# =============================================================================
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"    # True color support
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",alacritty:Tc"
set -ga terminal-overrides ",xterm-ghostty:Tc"

set -sg escape-time 0          # No delay for escape key (Vim responsiveness)
set -g history-limit 100000    # Generous scrollback
set -g mouse on                # Mouse support
set -g base-index 1            # Windows start at 1
set -g pane-base-index 1       # Panes start at 1
set -g renumber-windows on     # Renumber windows when one is closed
set -g repeat-time 1000        # Allow key repeat for flagged bindings (e.g., Ctrl+arrow)
set -g display-time 2000       # Status messages display time
set -g display-panes-time 3000 # Pane numbers display time

# Extended keys: allow Shift+Enter, Ctrl+Enter, etc. to pass through to apps
set -s extended-keys always
set -as terminal-features 'xterm*:extkeys'

# =============================================================================
# ZELLIJ-STYLE KEYBINDINGS (Alt + key, no prefix needed)
# =============================================================================

# Navigation: Alt + h/j/k/l (vim style)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Split creation: Alt + d/r (down/right, like Zellij)
bind -n M-d split-window -v -c "#{pane_current_path}"
bind -n M-r split-window -h -c "#{pane_current_path}"

# New window: Alt + t (like Zellij new tab)
bind -n M-t new-window -c "#{pane_current_path}"

# Window navigation: Alt + , / . (prev/next)
bind -n M-, previous-window
bind -n M-. next-window

# Zoom pane: Alt + f (like Zellij fullscreen toggle)
bind -n M-f resize-pane -Z

# Scratchpad toggle: Alt + s
bind -n M-s if-shell "[ '#{window_name}' = 'scratchpad' ]" \
    "last-window" \
    "if-shell 'tmux select-window -t scratchpad 2>/dev/null' '' 'new-window -n scratchpad'"

# Popup terminal: Alt + p
bind -n M-p display-popup -E -w 80% -h 80%

# Close pane: Alt + x
bind -n M-x kill-pane

# Swap panes: Shift + Arrow (spatial direction)
bind -n S-Left swap-pane -t '{left-of}'
bind -n S-Right swap-pane -t '{right-of}'
bind -n S-Up swap-pane -t '{up-of}'
bind -n S-Down swap-pane -t '{down-of}'

# =============================================================================
# PREFIX KEYBINDINGS (for less common actions)
# =============================================================================

# Reload config
bind r source-file ~/.config/tmux/tmux.conf \; display "Config reloaded"

# Split with prefix (traditional, also available)
bind v split-window -h -c "#{pane_current_path}"
bind h split-window -v -c "#{pane_current_path}"

# Intuitive mnemonic splits (visual representation of the split direction)
bind | split-window -h -c "#{pane_current_path}"   # | = vertical line = horizontal split
bind - split-window -v -c "#{pane_current_path}"   # - = horizontal line = vertical split

# Pane resizing with prefix + arrow keys (repeatable for continuous resize)
bind -r Up resize-pane -U 5
bind -r Down resize-pane -D 5
bind -r Left resize-pane -L 5
bind -r Right resize-pane -R 5

# Session management
bind s choose-tree -Zs          # Session picker
bind w choose-tree -Zw          # Window picker

# =============================================================================
# COPY MODE (Vi-style navigation)
# =============================================================================
setw -g mode-keys vi            # Use vim keybindings in copy/scroll mode

# Copy mode shortcuts: word jumping and character search (faster than arrows)
bind-key -T copy-mode-vi 'w' send -X next-word          # Jump to next word
bind-key -T copy-mode-vi 'b' send -X previous-word      # Jump to previous word
bind-key -T copy-mode-vi 'f' send -X jump-to-char       # Jump to character (press f, then char)
bind-key -T copy-mode-vi 'F' send -X jump-to-char -b    # Jump backwards to character

# =============================================================================
# CATPPUCCIN MACCHIATO THEME (no plugin, just colors)
# =============================================================================

# Palette
# Base: #24273a | Surface0: #363a4f | Surface1: #494d64
# Text: #cad3f5 | Subtext0: #a5adcb
# Mauve: #c6a0f6 | Blue: #8aadf4 | Teal: #8bd5ca | Green: #a6da95

# Status bar
set -g status-position bottom
set -g status-style "bg=#24273a,fg=#cad3f5"
set -g status-left-length 40
set -g status-right-length 40
set -g status-left "#[bg=#8aadf4,fg=#24273a,bold] #S #[bg=#24273a] "
set -g status-right "#[fg=#a5adcb]%-I:%M %p #[bg=#8aadf4,fg=#24273a,bold] #h "

# Window status
set -g window-status-format "#[fg=#a5adcb] #I:#W "
set -g window-status-current-format "#[bg=#363a4f,fg=#8aadf4,bold] #I:#W "
set -g window-status-separator ""

# Pane borders
set -g pane-border-style "fg=#494d64"
set -g pane-active-border-style "fg=#8aadf4"

# Message style
set -g message-style "bg=#363a4f,fg=#cad3f5"

# Mode style (copy mode, etc)
set -g mode-style "bg=#363a4f,fg=#cad3f5"
