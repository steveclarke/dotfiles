# Example: Detection Script Only Request

**Scenario:** User only wants a script to find breaking changes

---

## User Request

```
User: "Create a detection script for Rails 8.0 breaking changes"
```

---

## Claude's Response Workflow

### Step 1: Detect Version
```
Call: railsMcpServer:project_info
Result: Current = 7.2.3
```

### Step 2: Load Only What's Needed
```
Read: workflows/detection-script-workflow.md
Read: detection-scripts/patterns/rails-80-patterns.yml
Read: detection-scripts/templates/detection-script-template.sh
```

**Note:** Skip upgrade report and app:update preview (user didn't ask for them)

### Step 3: Generate Detection Script Only
```
Follow: workflows/detection-script-workflow.md
Output: Single bash script
```

---

## Claude's Complete Response

```markdown
I'll create a detection script for Rails 8.0 breaking changes that you can run in your project.

---

## üîç Breaking Changes Detection Script for Rails 8.0

This script searches your codebase for patterns that break in Rails 8.0.

### Download Script

\```bash
chmod +x detect_rails_80_changes.sh
./detect_rails_80_changes.sh
\```

### Script Contents

\```bash
#!/bin/bash

# Rails 8.0 Upgrade Detection Script
# Generated by Rails Upgrade Assistant
# Run this in your Rails project root

set -e

RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m'

OUTPUT_FILE="rails_80_upgrade_findings.txt"

echo "================================================" | tee "$OUTPUT_FILE"
echo "Rails 8.0 Upgrade - Breaking Changes Detection" | tee -a "$OUTPUT_FILE"
echo "Project: $(basename $(pwd))" | tee -a "$OUTPUT_FILE"
echo "Date: $(date)" | tee -a "$OUTPUT_FILE"
echo "================================================" | tee -a "$OUTPUT_FILE"
echo "" | tee -a "$OUTPUT_FILE"

check_results() {
  local count=$1
  local name=$2
  if [ "$count" -gt 0 ]; then
    echo -e "${RED}   ‚ö†Ô∏è  Found: $count occurrences${NC}" | tee -a "$OUTPUT_FILE"
    return 0
  else
    echo -e "${GREEN}   ‚úÖ None found${NC}" | tee -a "$OUTPUT_FILE"
    return 1
  fi
}

echo "üî¥ HIGH PRIORITY - BREAKING CHANGES" | tee -a "$OUTPUT_FILE"
echo "===================================" | tee -a "$OUTPUT_FILE"
echo "" | tee -a "$OUTPUT_FILE"

# Propshaft Migration
echo "üîç Checking: Sprockets asset pipeline" | tee -a "$OUTPUT_FILE"
echo "   Rails 8.0 replaces Sprockets with Propshaft" | tee -a "$OUTPUT_FILE"

SPROCKETS_RESULTS=$(grep -r "config.assets" config/ | wc -l | tr -d ' ')
SPROCKETS_FILES=$(grep -rl "config.assets" config/)

check_results $SPROCKETS_RESULTS "Sprockets configuration"

if [ "$SPROCKETS_RESULTS" -gt 0 ]; then
  echo "" | tee -a "$OUTPUT_FILE"
  echo "   Files affected:" | tee -a "$OUTPUT_FILE"
  echo "$SPROCKETS_FILES" | sed 's/^/   - /' | tee -a "$OUTPUT_FILE"
  echo "" | tee -a "$OUTPUT_FILE"
  echo "   Fix: Migrate to Propshaft (see upgrade guide)" | tee -a "$OUTPUT_FILE"
  echo "" | tee -a "$OUTPUT_FILE"
fi

# [More checks generated...]

echo "" | tee -a "$OUTPUT_FILE"
echo "üìä SUMMARY" | tee -a "$OUTPUT_FILE"
echo "==========" | tee -a "$OUTPUT_FILE"
echo "" | tee -a "$OUTPUT_FILE"

TOTAL_ISSUES=$((SPROCKETS_RESULTS + ...))

if [ "$TOTAL_ISSUES" -eq 0 ]; then
  echo -e "${GREEN}‚úÖ No breaking changes detected!${NC}" | tee -a "$OUTPUT_FILE"
else
  echo -e "${RED}‚ö†Ô∏è  Found $TOTAL_ISSUES breaking change(s)${NC}" | tee -a "$OUTPUT_FILE"
fi

echo "" | tee -a "$OUTPUT_FILE"
echo "üìã AFFECTED FILES" | tee -a "$OUTPUT_FILE"
echo "=================" | tee -a "$OUTPUT_FILE"
echo "" | tee -a "$OUTPUT_FILE"

ALL_FILES="$SPROCKETS_FILES ..."
echo "$ALL_FILES" | tr ' ' '\n' | sort -u | tee -a "$OUTPUT_FILE"

echo "" | tee -a "$OUTPUT_FILE"
echo "Neovim command:" | tee -a "$OUTPUT_FILE"
echo "nvim $ALL_FILES" | tee -a "$OUTPUT_FILE"

echo "" | tee -a "$OUTPUT_FILE"
echo "================================================" | tee -a "$OUTPUT_FILE"
echo "Report saved to: $OUTPUT_FILE" | tee -a "$OUTPUT_FILE"
echo "================================================" | tee -a "$OUTPUT_FILE"
\```

---

## üìä What This Script Does

1. ‚úÖ Searches for Sprockets asset pipeline usage
2. ‚úÖ Finds Solid Cache/Queue/Cable migration needs
3. ‚úÖ Detects deprecated API usage
4. ‚úÖ Shows file:line references for each issue
5. ‚úÖ Generates `rails_80_upgrade_findings.txt` report
6. ‚úÖ Lists all affected files
7. ‚úÖ Provides Neovim command to open files

---

## üöÄ How to Use

### Step 1: Save the Script
Copy the script above to `detect_rails_80_changes.sh`

### Step 2: Make Executable
\```bash
chmod +x detect_rails_80_changes.sh
\```

### Step 3: Run in Your Project
\```bash
cd /path/to/your/rails/project
./detect_rails_80_changes.sh
\```

### Step 4: Review Output
- Check console for summary
- Read `rails_80_upgrade_findings.txt` for details
- Use Neovim command to open affected files

---

## üìã Example Output

\```
================================================
Rails 8.0 Upgrade - Breaking Changes Detection
Project: my-rails-app
Date: November 2, 2025
================================================

üî¥ HIGH PRIORITY - BREAKING CHANGES
===================================

üîç Checking: Sprockets asset pipeline
   Rails 8.0 replaces Sprockets with Propshaft
   ‚ö†Ô∏è  Found: 4 occurrences

   Files affected:
   - config/application.rb
   - config/environments/production.rb
   - config/initializers/assets.rb

   Fix: Migrate to Propshaft (see upgrade guide)

...

üìä SUMMARY
==========

‚ö†Ô∏è  Found 7 breaking change(s) that need fixing:
   - Sprockets configuration: 4 occurrence(s)
   - Solid Cache migration: 2 occurrence(s)
   - Deprecated API: 1 occurrence(s)

üìã AFFECTED FILES
=================

config/application.rb
config/environments/production.rb
config/initializers/assets.rb
config/initializers/redis.rb

Neovim command:
nvim config/application.rb config/environments/production.rb ...
\```

---

## üí° Next Steps

After running the script:

1. **Review the findings report**
2. **Share it with me** for help fixing issues
3. **Open files in Neovim** using the command provided
4. **Ask me:** "Help me fix these breaking changes"

I can then help you fix each issue interactively!

---

Would you also like:
- The complete upgrade report? (Say: "generate upgrade report")
- The app:update preview? (Say: "show app:update preview")
```

---

## Key Characteristics

‚úÖ **Generated ONLY detection script** (user's request)  
‚úÖ **Skipped other deliverables** (not requested)  
‚úÖ **Provided clear usage instructions**  
‚úÖ **Explained what the script does**  
‚úÖ **Offered to generate other deliverables if needed**

---

## When to Use This Approach

Use detection-script-only when user:
- Specifically asks for "detection script"
- Says "find breaking changes in my code"
- Wants to check compatibility before committing to upgrade
- Already has an upgrade plan, just needs verification

---

**Related Files:**
- Workflow: `workflows/detection-script-workflow.md`
- Patterns: `detection-scripts/patterns/*.yml`
- Template: `detection-scripts/templates/detection-script-template.sh`
